<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover Instagram User ID - Debug Tools</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-search"></i> Discover Instagram User ID</h1>
            <p>Automatically discover the correct Instagram User ID for EgoInspo using Facebook API</p>
        </div>

        <div class="debug-section">
            <div class="debug-card">
                <div class="card-header">
                    <h3><i class="fas fa-magic"></i> Instagram ID Discovery</h3>
                </div>
                <div class="card-content">
                    <p><strong>üéØ Objective:</strong> Find the correct Instagram User ID that works with the messaging API.</p>
                    
                    <div class="info-box">
                        <h4>üìã Current Situation:</h4>
                        <ul>
                            <li><strong>Current ID:</strong> <code>71457471009</code> (11 digits) ‚ùå <em>Doesn't work</em></li>
                            <li><strong>Chata ID:</strong> <code>745508148639483</code> (15 digits) ‚úÖ <em>Works perfectly</em></li>
                            <li><strong>Problem:</strong> Different ID format suggests we're using the wrong type of ID</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h4>üîç Discovery Process:</h4>
                        <ol>
                            <li>Use the Page Access Token to query Facebook API</li>
                            <li>Get Instagram Business Account ID from the Page</li>
                            <li>Extract the correct Instagram User ID from Business Account</li>
                            <li>This should give us the same format as Chata's working ID</li>
                        </ol>
                    </div>

                    <button onclick="discoverInstagramId()" class="btn btn-primary">
                        <i class="fas fa-search"></i> Discover Instagram User ID
                    </button>

                    <div id="result" class="result-box" style="display: none;">
                        <h4>üîç Discovery Results:</h4>
                        <pre id="result-content"></pre>
                    </div>
                </div>
            </div>

            <div class="debug-card">
                <div class="card-header">
                    <h3><i class="fas fa-info-circle"></i> What This Will Do</h3>
                </div>
                <div class="card-content">
                    <p>This tool will:</p>
                    <ul>
                        <li>‚úÖ Query Facebook API using EgoInspo's Page Access Token</li>
                        <li>‚úÖ Find the Instagram Business Account linked to the Page</li>
                        <li>‚úÖ Extract the correct Instagram User ID (should be 15 digits like Chata)</li>
                        <li>‚úÖ Show you the exact ID that should work with messaging API</li>
                    </ul>
                    
                    <p><strong>Expected Result:</strong> A 15-digit Instagram User ID similar to Chata's format.</p>
                </div>
            </div>
        </div>

        <div class="debug-actions">
            <a href="/dashboard" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
            <a href="/debug/health-check" class="btn btn-secondary">
                <i class="fas fa-heartbeat"></i> Health Check
            </a>
        </div>
    </div>

    <script>
        function discoverInstagramId() {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('result-content');
            
            resultDiv.style.display = 'block';
            resultContent.textContent = 'üîç Discovering Instagram User ID...';
            
            fetch('/debug/discover-instagram-id', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultContent.innerHTML = `
‚úÖ SUCCESS! Instagram User ID Discovered:

üìä Current ID (Wrong): ${data.current_id}
üéØ Discovered ID (Correct): ${data.discovered_id}
üìÑ Page ID: ${data.page_id}

üí° Next Steps:
1. Update the database with the correct ID: ${data.discovered_id}
2. Test messaging with the new ID
3. The format should now match Chata's working ID format

${data.message}
                    `;
                } else {
                    resultContent.innerHTML = `
‚ùå FAILED to discover Instagram User ID:

Error: ${data.error}

üîß Troubleshooting:
- Check if Page Access Token is valid
- Verify Instagram account is properly linked to Facebook Page
- Ensure all required permissions are granted
                    `;
                }
            })
            .catch(error => {
                resultContent.innerHTML = `
‚ùå ERROR: ${error.message}

üîß Check:
- Network connection
- Server logs for detailed error information
                `;
            });
        }
    </script>
</body>
</html>
